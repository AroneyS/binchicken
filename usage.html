<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>usage</title>
    <meta name="description" content="Documentation for Bin Chicken">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Source+Sans+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/binchicken/assets/normalize.css?v=1770330212"
        media="screen" />
    <link rel="stylesheet" type="text/css" href="/binchicken/assets/doctave-style.css?v=1770330212"
        media="screen" />
    <link rel="stylesheet" type="text/css" href="/binchicken/assets/katex.css?v=1770330212" media="screen" />
    <link rel="stylesheet" type="text/css" href="/binchicken/assets/prism-ghcolors.css?v=1770330212"
        media="screen" />

    <script>
        var DOCTAVE_TIMESTAMP = "1770330212";
        var BASE_PATH = "/binchicken/";
        var color = localStorage.getItem('doctave-color')

        if (color === 'dark') {
            document.getElementsByTagName('html')[0].classList.remove('light');
            document.getElementsByTagName('html')[0].classList.add('dark');
        } else {
            document.getElementsByTagName('html')[0].classList.remove('dark');
            document.getElementsByTagName('html')[0].classList.add('light');
        }
    </script>

    
</head>

<body>
    <label for='menu-toggle-switch' class='menu-toggle-button'>
        â˜°
    </label>
    <input type="checkbox" id="menu-toggle-switch" value='0' />
    <div class='page'>
        <div class='header'>
            <div class='logo'>
                
                <a href="/binchicken/">
                    <img src="/binchicken/binchicken_logo.png" alt='Bin Chicken logo'></img>
                </a>
                
                <h2 class='project-name'>
                    <a href="/binchicken/">
                        Bin Chicken
                    </a>
                </h2>
            </div>
            <div class='search'>
                <form id='search-form'>
    <input type='text' id='search-box' autocomplete="off" placeholder="Search..."></input>
    <span class='search-icon'>S</span>
    <ul id='search-results'></ul>
</form>

            </div>
            <div class='header-dummy-right'>
            </div>
        </div>
        <div class='container'>
            <div class='sidebar-left'>
                <nav class='site-nav'>
    <ul>
        
            <li><a href="/binchicken/installation">installation</a></li>
            
        
            <li><a href="/binchicken/setup">setup</a></li>
            
        
            <li><a class="active" href="/binchicken/usage">usage</a></li>
            
        
            <li><a href="/binchicken/demo">demo</a></li>
            
        
            <li><a href="/binchicken/tools">tools</a></li>
            
                <ul>
    
        <li><a href="/binchicken/tools/coassemble">Bin Chicken coassemble</a></li>
        
    
        <li><a href="/binchicken/tools/single">Bin Chicken single</a></li>
        
    
        <li><a href="/binchicken/tools/update">Bin Chicken update</a></li>
        
    
        <li><a href="/binchicken/tools/iterate">Bin Chicken iterate</a></li>
        
    
        <li><a href="/binchicken/tools/evaluate">Bin Chicken evaluate</a></li>
        
    
        <li><a href="/binchicken/tools/build">Bin Chicken build</a></li>
        
    
</ul>

            
        
    </ul>
    <span id='light-dark-mode-switch'>
        <svg xmlns="http://www.w3.org/2000/svg" id="dark-mode-icon" viewBox="0 0 20 20" fill="currentColor">
            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
        </svg>

        <svg xmlns="http://www.w3.org/2000/svg" id="light-mode-icon" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd" />
        </svg>
    </span>
</nav>

            </div>
            <div class='doctave-content'>
                <h1 id="general-usage">General usage</h1>
<h2 id="general-options">General Options</h2>
<ul>
<li><strong>Cores</strong>: The <code>--cores</code> option sets the maximum number of cores to use. The default value is 1. When running in cluster mode, this restricts the number of cores per job submitted.</li>
<li><strong>Local Cores</strong>: The <code>--local-cores</code> option sets the maximum number of cores to use on local rules when running in cluster mode. The default value is 1.</li>
<li><strong>Cluster Retries</strong>: The <code>--cluster-retries</code> option sets the number of times to retry a failed job. The default value is 3. This is especially important when using <code>--run-aviary</code> to run assembly and genome recovery. Jobs are submitted with sequentially increasing walltime, and sometimes CPUs and RAM with each failure. See below.</li>
</ul>
<h2 id="memory-issues">Memory issues</h2>
<p>If you encounter memory issues with target_elusive or cluster_graph, you can try the following:</p>
<ul>
<li><strong>Kmer preclustering</strong>: The <code>--kmer-precluster</code> option can be set to <code>always</code> to enable kmer preclustering. This is the default if more than 1000 samples are provided. This greatly reduces memory usage and allows scaling up to at least 250k samples on a single HPC node. Kmer preclustering can be disabled with <code>--kmer-precluster never</code>.</li>
<li><strong>Precluster size</strong>: The <code>--precluster-size</code> option sets the maximum number of samples to use for preclustering. The default value is 5 x the number of recovery samples. Reducing this value will reduce memory usage by reducing the number of combinations that are considered. However, this reduces the samples combinations that are considered for both coassembly and differential-abundance binning (co-binning), so may result in sub-optimal coassembly suggestions.</li>
<li><strong>Target taxa</strong>: The <code>--taxa-of-interest</code> option can be used to filter the taxa of the considered sequences to target a specific taxon. This can reduce memory usage.</li>
</ul>
<h2 id="cluster-submission">Cluster submission</h2>
<p>Snakemake profiles can be used to automatically submit jobs to HPC clusters (<code>--snakemake-profile</code>).
Note that Aviary assemble commands are submitted to the cluster, while Aviary recover commands are run locally such that Aviary handles cluster submission.
The <code>--cluster-submission</code> flag sets the local Aviary recover thread usage to 1, to enable multiple runs in parallel by setting <code>--local-cores</code> to greater than 1.
This is required to prevent <code>--local-cores</code> from limiting the number of threads per submitted job.</p>
<h2 id="aviary-assemble">Aviary Assemble</h2>
<ul>
<li><strong>Maximum number of cores</strong>: The <code>--aviary-assemble-cores</code> option sets the maximum number of cores for Aviary assemble to use. The default value is 64.</li>
<li><strong>Maximum amount of memory</strong>: The <code>--aviary-assemble-memory</code> option sets the maximum amount of memory for Aviary assemble to use (in Gigabytes). The default value is 500.</li>
<li><strong>Dynamic assembly strategy</strong>: The <code>--assembly-strategy dynamic</code> (default) option means that assembly is initially attempted using metaSPAdes with 32 CPUs, 250 GB RAM. If this fails, metaSPAdes is attempted again with 64 CPUs, 500 GB RAM. If this also fails, MEGAHIT is attempted with 32 CPUs, 250 GB RAM.</li>
<li><strong>MetaSPAdes assembly strategy</strong>: The <code>--assembly-strategy metaspades</code> option means that assembly is attempted using metaSPAdes with 32 CPUs, 250 GB RAM, with CPUs and RAM increasing with each attempt.</li>
<li><strong>MEGAHIT assembly strategy</strong>: The <code>--assembly-strategy megahit</code> option means that assembly is attempted using MEGAHIT with 32 CPUs, 250 GB RAM, with CPUs and RAM increasing with each attempt.</li>
<li><strong>Assemble unmapped</strong>: The <code>--assemble-unmapped</code> option means that reads are first mapped to reference genomes, and only unmapped reads are assembled. This can reduce the complexity of the assembly, thus reducing computational requirements. Note that will likely reduce the number of recovered novel genomes, possibly due to overlap of reads from conserved sequences of different species.</li>
</ul>
<h2 id="aviary-recover">Aviary Recover</h2>
<ul>
<li><strong>Maximum number of cores</strong>: The <code>--aviary-recover-cores</code> option sets the maximum number of cores for Aviary recover to use. The default value is 32. If <code>--cluster-submission</code> is set, then this applies to jobs submitted by Aviary. Binners, refinement steps and characterisation are submitted as separate jobs.</li>
<li><strong>Maximum amount of memory</strong>: The <code>--aviary-recover-memory</code> option sets the maximum amount of memory for Aviary recover to use (in Gigabytes). The default value is 250. If <code>--cluster-submission</code> is set, then this applies to jobs submitted by Aviary.</li>
</ul>

            </div>
            <div class='sidebar-right'>
                <div class='page-nav' id='page-nav'>
                    <p class='page-nav-header'>On this page</p>
                    <ul>
                        
                        <li class='page-nav-level-1'>
                            <a href='#general-usage'>General usage</a>
                        </li>
                        
                        <li class='page-nav-level-2'>
                            <a href='#general-options'>General Options</a>
                        </li>
                        
                        <li class='page-nav-level-2'>
                            <a href='#memory-issues'>Memory issues</a>
                        </li>
                        
                        <li class='page-nav-level-2'>
                            <a href='#cluster-submission'>Cluster submission</a>
                        </li>
                        
                        <li class='page-nav-level-2'>
                            <a href='#aviary-assemble'>Aviary Assemble</a>
                        </li>
                        
                        <li class='page-nav-level-2'>
                            <a href='#aviary-recover'>Aviary Recover</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
            <div class='wave-container'>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
                    <path fill-opacity="0.35"
                        d="M0,192L60,213.3C120,235,240,277,360,277.3C480,277,600,235,720,192C840,149,960,107,1080,122.7C1200,139,1320,213,1380,250.7L1440,288L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z">
                    </path>
                    <path fill-opacity="0.5"
                        d="M0,160L60,181.3C120,203,240,245,360,229.3C480,213,600,139,720,138.7C840,139,960,213,1080,229.3C1200,245,1320,203,1380,181.3L1440,160L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z">
                    </path>
                    <path fill-opacity="0.2"
                        d="M0,224L60,197.3C120,171,240,117,360,117.3C480,117,600,171,720,186.7C840,203,960,181,1080,186.7C1200,192,1320,224,1380,240L1440,256L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z">
                    </path>
                </svg>
                <p>Powered by <a href='https://cli.doctave.com' target='_blank'>Doctave</a></p>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="/binchicken/assets/katex.js?v=1770330212"></script>
    <script type="text/javascript" src="/binchicken/assets/mermaid.js?v=1770330212"></script>
    <script type="text/javascript" src="/binchicken/assets/elasticlunr.js?v=1770330212"></script>
    <script type="text/javascript" src="/binchicken/assets/prism.js?v=1770330212"></script>
    <script type="text/javascript" src="/binchicken/assets/doctave-app.js?v=1770330212"></script>

    
</body>

</html>