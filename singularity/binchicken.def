Bootstrap: docker
From: continuumio/miniconda3:24.4.0-0

%environment
    export SINGLEM_METAPACKAGE_PATH=/singlem_metapackage
    export CHECKM2DB=/CheckM2_database
    export CONDA_ENV_PATH=/opt/conda/envs/

%post
    /opt/conda/bin/conda create -n binchicken -c conda-forge -c bioconda binchicken>=0.11.*
    . $(conda info --base)/etc/profile.d/conda.sh
    conda activate binchicken
    binchicken build --conda-prefix /opt/conda/envs/ --singlem-metapackage /singlem_metapackage --checkm2-db /CheckM2_database --download-databases
    find /singlem_metapackage /CheckM2_database -type d -print0 | xargs -0 chmod 755
    find /singlem_metapackage /CheckM2_database -type f -print0 | xargs -0 chmod +r
    rm -rf build genome_1.fna sample_*
    conda clean -af
    rm -rf /opt/conda/envs/*/pkgs

%test
    . $(conda info --base)/etc/profile.d/conda.sh
    conda activate binchicken
    binchicken -h

%runscript
    . $(conda info --base)/etc/profile.d/conda.sh
    conda activate binchicken
    exec "$@"

%labels
    Author Samuel Aroney
    Version v0.12.1
